set role dsbench;
:EXPLAIN_ANALYZE
-- start query 16 in stream 2 using template query8.tpl and seed 531403919
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39711','44888','50344','97236','51966','91211',
                          '50283','37483','97158','55045','26805',
                          '48827','33160','87992','35822','75592',
                          '31037','33084','96260','53511','24600',
                          '68107','83212','80198','33238','95739',
                          '56758','59037','23124','93962','33961',
                          '44031','79425','41336','36169','22782',
                          '88717','53139','10231','89252','38722',
                          '77067','61194','42710','90450','48829',
                          '18499','96199','44213','80296','78682',
                          '10595','95144','80827','87135','34944',
                          '61445','95454','21811','48867','26871',
                          '62466','11687','15538','95295','98980',
                          '96125','41012','65654','30266','84151',
                          '42200','92470','23901','57501','12576',
                          '91332','33128','51983','59218','96562',
                          '12615','64628','98799','27330','30176',
                          '61577','65541','90019','47501','91533',
                          '72322','66503','67187','36447','33222',
                          '42676','14045','84770','34407','20037',
                          '33710','59130','27296','14851','18142',
                          '25938','52422','37182','72797','87310',
                          '19036','27466','95525','80174','89848',
                          '29050','34738','96986','57939','43538',
                          '23807','61556','70852','91465','44340',
                          '23264','49667','31821','35771','86194',
                          '20154','48968','80764','62839','85875',
                          '97554','42279','76189','13369','76518',
                          '22762','55847','80955','30126','89034',
                          '36129','11033','69021','58221','44827',
                          '22322','84724','57089','63744','12898',
                          '18359','38129','76963','17489','40822',
                          '29643','17327','34042','62095','39393',
                          '12880','23478','15471','65456','38249',
                          '10514','38312','74351','99568','39577',
                          '46517','86599','99575','71117','70001',
                          '65715','12522','38629','39361','11280',
                          '60964','34165','27282','58004','96904',
                          '88773','16176','96053','16444','96964',
                          '75991','18036','43048','86708','89338',
                          '81408','80251','12208','81820','70420',
                          '35979','12505','12528','75724','38090',
                          '98697','41771','42121','25626','65751',
                          '12700','85899','59131','65821','81020',
                          '85150','97210','56707','46184','47322',
                          '23596','10880','82606','29169','29096',
                          '23090','14952','17441','69126','51366',
                          '98693','22292','82379','70114','53919',
                          '49690','82120','28682','68948','34575',
                          '15199','23902','25250','39933','23422',
                          '19884','81791','31608','20749','30017',
                          '48522','20549','53473','26318','93454',
                          '82158','90969','88513','69621','57334',
                          '69638','39358','24128','35751','40389',
                          '51887','81464','22199','66761','41801',
                          '76783','56609','24685','76225','87921',
                          '83052','16378','75652','43475','19489',
                          '52080','96211','10789','39463','98285',
                          '41550','89413','68069','20849','60672',
                          '67567','66065','48346','93200','92237',
                          '57842','62267','18821','42836','53218',
                          '31673','23335','41496','32781','63232',
                          '79561','38958','67731','89228','98609',
                          '12154','41804','31160','47688','81481',
                          '22002','69431','12234','39585','28619',
                          '17453','41602','68860','44159','71321',
                          '61321','25268','78986','78775','23340',
                          '91695','68202','37370','21327','88771',
                          '75743','29839','17031','94452','52820',
                          '49364','88500','13839','42909','16316',
                          '24674','42233','78023','61153','53417',
                          '74187','53177','85212','35036','14405',
                          '24323','53167','95700','28481','16486',
                          '89225','40983','17244','42477','89459',
                          '58754','89527','50663','35783','26168',
                          '18103','87658','22241','19163','72613',
                          '45325','21685','89719','24862','97413',
                          '48485','49853','85109','11864','73240',
                          '32827','15236','63007','22445','28962',
                          '29723','28272','50623','90475')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 16 in stream 2 using template query8.tpl
