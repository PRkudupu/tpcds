set role dsbench;
:EXPLAIN_ANALYZE
-- start query 25 in stream 3 using template query8.tpl and seed 277453149
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '56956','33252','26408','91475','53721','13474',
                          '17265','76552','82853','20907','38122',
                          '34917','42257','39289','74555','72132',
                          '85353','86862','70344','81243','79668',
                          '53619','77131','71735','31746','43387',
                          '61218','74363','30729','72223','13917',
                          '27618','18632','11191','38701','45294',
                          '26846','64630','17054','26424','53698',
                          '79363','24029','42282','32221','69165',
                          '35234','23396','39381','59044','10999',
                          '34974','27573','39462','87428','52753',
                          '95352','37867','52541','31057','78212',
                          '90381','26431','37242','89986','74685',
                          '23749','30266','34574','97572','12642',
                          '83479','84889','28344','16042','70448',
                          '97173','19796','72920','60085','70589',
                          '21164','58696','12847','74304','57092',
                          '68374','60793','72087','98942','52512',
                          '48707','45458','60274','25115','76614',
                          '54263','10454','44023','37496','24587',
                          '58912','29940','95696','12294','13789',
                          '32393','42339','96678','70493','85292',
                          '64741','29377','67016','25015','68267',
                          '19108','43922','82860','83743','78849',
                          '12823','46382','52651','79090','28947',
                          '39955','13495','65210','57035','10103',
                          '56324','93342','47833','79609','36838',
                          '77753','41191','38333','12962','63585',
                          '24814','60623','20016','96560','64486',
                          '54810','27645','51932','37848','69571',
                          '45690','27422','78762','97908','94830',
                          '57405','32674','79575','55510','83375',
                          '57658','79380','31986','97065','71728',
                          '35817','29434','62722','46052','32746',
                          '93728','78630','21227','70306','15073',
                          '54944','79835','97984','39030','69596',
                          '91718','22363','67499','75516','76271',
                          '30177','61612','43329','77788','16336',
                          '71155','94039','27164','87669','70023',
                          '63110','14848','86805','35492','74836',
                          '43918','21493','34035','95082','61357',
                          '29513','33635','67464','91494','60245',
                          '53005','18463','37390','47629','68457',
                          '59282','32693','83895','52523','32299',
                          '52522','84919','76141','19953','95690',
                          '67989','91349','51753','81904','11231',
                          '42649','17981','65216','44777','61321',
                          '79905','58743','67528','29752','89070',
                          '41585','99063','56652','40382','19246',
                          '74625','80445','34980','21880','82530',
                          '44968','42721','74127','20134','31499',
                          '75199','89172','87079','62406','12969',
                          '25833','17919','88546','11461','65749',
                          '61192','42835','61424','64685','63549',
                          '35016','61956','17198','54617','13033',
                          '66039','47458','40697','40421','97776',
                          '78867','87044','55170','16036','70602',
                          '22851','74118','70167','16150','47482',
                          '66426','49782','99149','73853','53243',
                          '76358','53159','28402','67737','78264',
                          '67556','98440','31718','77902','24685',
                          '68644','21606','32136','19188','91391',
                          '10309','83226','59054','61237','87183',
                          '23923','67766','31891','45341','96872',
                          '47515','12940','46240','14829','28697',
                          '15931','12232','34805','58795','79960',
                          '37774','33931','23540','10079','90928',
                          '56544','84739','43422','41058','19916',
                          '83774','53410','66667','97448','65702',
                          '52749','45628','92195','78923','18371',
                          '43313','67433','53172','23094','32777',
                          '16179','52860','64096','81050','15384',
                          '89018','59364','47413','90760','67853',
                          '24465','21343','18193','56401','47017',
                          '49335','88158','23333','35109','23528',
                          '65168','78136','64999','52994','76762',
                          '90497','16801','24953','78364','37141',
                          '73021','23022','34248','94668','23921',
                          '42434','58555','31971','72491','76464',
                          '42625','63085','56677','68685')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 25 in stream 3 using template query8.tpl
