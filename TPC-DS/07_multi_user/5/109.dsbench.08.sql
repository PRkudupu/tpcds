set role dsbench;
:EXPLAIN_ANALYZE
-- start query 9 in stream 4 using template query8.tpl and seed 974696121
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '43085','14317','45842','53698','83215','18995',
                          '99538','98299','55226','24825','75375',
                          '77013','34296','59501','71939','80724',
                          '14606','33124','97015','40297','40546',
                          '15199','30525','80882','17329','61419',
                          '10835','11256','99168','53906','83430',
                          '57404','91978','21429','68920','45324',
                          '66258','38020','89733','47485','48023',
                          '78374','36267','61082','26101','68675',
                          '97199','44390','27571','27174','40564',
                          '33787','53538','46243','33950','21949',
                          '19187','99316','56943','43390','61736',
                          '43755','48897','46539','26396','51409',
                          '99821','75809','39782','43844','86732',
                          '96892','57734','41567','27576','68330',
                          '88568','88762','67005','54748','84809',
                          '83223','29191','23934','47393','49682',
                          '42781','60812','87887','17413','90177',
                          '74062','40597','79009','64422','65476',
                          '48946','59774','78708','98334','30003',
                          '66553','74854','80700','88117','20731',
                          '76914','80113','28546','22270','15127',
                          '89208','94509','27321','51684','88513',
                          '64878','15969','19330','64705','29656',
                          '33864','20748','72722','28593','54148',
                          '19947','97136','95271','24296','81263',
                          '69577','35661','76857','73133','48882',
                          '50807','16524','13525','41506','38619',
                          '11765','58085','17646','87791','15021',
                          '16621','58302','93003','68761','44011',
                          '35457','15796','12363','93125','84986',
                          '54460','70965','23699','80031','64998',
                          '69224','27041','65657','67983','37751',
                          '39968','65926','61901','18181','20258',
                          '92821','96357','44986','93915','23316',
                          '30314','90002','23793','40391','25510',
                          '80356','61589','12460','34161','50917',
                          '56435','74738','67924','36201','24787',
                          '94654','21459','87041','19452','99287',
                          '90593','44926','64074','68571','61824',
                          '82493','36088','90109','27218','65825',
                          '40064','27791','32524','91175','30854',
                          '46744','27607','11959','72246','18053',
                          '14989','31097','58836','81915','74184',
                          '78156','20572','37590','84012','14803',
                          '28738','42428','13530','78670','90186',
                          '74068','11494','39082','24613','92366',
                          '61859','10674','55771','35395','91754',
                          '97428','43094','43507','23266','38001',
                          '45636','45101','64031','86264','33811',
                          '25014','16186','67178','50629','63215',
                          '15492','43387','26859','71054','91610',
                          '91940','20494','73494','82291','32611',
                          '43376','58720','66903','15866','95435',
                          '97674','36381','97650','47177','48469',
                          '80812','29043','48155','56322','60305',
                          '54815','16927','94532','88000','56612',
                          '19297','32287','36062','51402','91423',
                          '80365','28478','48281','38602','92289',
                          '61607','99172','14187','91801','79367',
                          '93255','40735','11624','57545','59459',
                          '29164','80468','48865','84424','75377',
                          '94245','91943','15740','13030','93446',
                          '99368','63454','24871','54800','82327',
                          '82094','11152','36383','48005','23088',
                          '49630','62957','41650','21292','22464',
                          '38652','16301','15925','64258','68903',
                          '60140','95037','65562','30244','42253',
                          '99987','30403','89584','68906','65240',
                          '55441','25473','56705','83894','12021',
                          '62895','18117','81367','58267','15297',
                          '56057','78251','35288','93958','49583',
                          '44442','89650','83059','78018','69689',
                          '48207','75659','31011','71975','12683',
                          '65624','15009','69645','53140','17239',
                          '14329','50031','25055','98389','85888',
                          '85064','51078','43371','76235','72823',
                          '69958','91627','79622','64813','81860',
                          '75840','24585','59907','93205','67853',
                          '83123','20718','78902','83704')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 9 in stream 4 using template query8.tpl
